{% extends 'base_sidebar.html' %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>System QR Code Configuration</h2>
    <a href="{% url 'accounts:admin_dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
  </div>

  {% if messages %}
    <div class="alert-container">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="row">
    <!-- Registration QR Code -->
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="fas fa-qrcode me-2"></i>Registration Payment QR Code</h5>
        </div>
        <div class="card-body">
          <p class="text-muted">
            Upload the QR-PH code that students will use to pay their registration fee. This QR code will be shown to new users immediately after they create their account.
          </p>

          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="mb-3">
              {% if config.registration_qr_code %}
                <div class="mb-3">
                  <label class="form-label fw-bold">Current QR Code:</label>
                  <div class="text-center">
                    <img src="{{ config.registration_qr_code.url }}" alt="Registration QR Code" class="img-fluid border rounded" style="max-width: 300px;">
                  </div>
                  <small class="text-muted d-block mt-2">
                    Last updated: {{ config.updated_at|date:"M d, Y h:i A" }}
                    {% if config.updated_by %}by {{ config.updated_by.get_full_name }}{% endif %}
                  </small>
                </div>
              {% else %}
                <div class="alert alert-warning">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  No registration QR code uploaded yet. Students won't be able to see payment instructions until you upload one.
                </div>
              {% endif %}

              <label for="{{ form.registration_qr_code.id_for_label }}" class="form-label fw-bold">
                {{ form.registration_qr_code.label }}
              </label>
              {{ form.registration_qr_code }}
              {% if form.registration_qr_code.help_text %}
                <div class="form-text">{{ form.registration_qr_code.help_text }}</div>
              {% endif %}
              {% if form.registration_qr_code.errors %}
                <div class="text-danger mt-2">{{ form.registration_qr_code.errors }}</div>
              {% endif %}
            </div>

            <div class="d-grid">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Save QR Code
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="col-lg-6">
      <div class="card shadow-sm bg-light">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>How to Use</h5>
        </div>
        <div class="card-body">
          <h6 class="fw-bold">Step 1: Generate QR-PH Code</h6>
          <ol class="small">
            <li>Log in to your payment provider (GCash, PayMaya, etc.)</li>
            <li>Navigate to "QR PH" or "Generate QR Code" section</li>
            <li>Set the fixed amount for registration fee (if applicable)</li>
            <li>Download or screenshot the QR code</li>
          </ol>

          <h6 class="fw-bold mt-3">Step 2: Upload QR Code</h6>
          <ol class="small">
            <li>Click "Choose File" above</li>
            <li>Select your QR code image (JPG or PNG format)</li>
            <li>Click "Save QR Code"</li>
          </ol>

          <h6 class="fw-bold mt-3">How Students Will See It:</h6>
          <ul class="small">
            <li>After creating an account, students immediately see the QR code</li>
            <li>They scan it using their payment app to pay the registration fee</li>
            <li>They upload their payment receipt with reference number</li>
            <li>Admin verifies the payment and grants access to events</li>
          </ul>

          <div class="alert alert-info mt-3 mb-0">
            <i class="fas fa-lightbulb me-2"></i>
            <strong>Tip:</strong> You can update this QR code anytime. The new QR code will be shown to all new registrations and pending payments.
          </div>
        </div>
      </div>

      <!-- Future: Donation QR Code section can be added here -->
    </div>
  </div>
</div>
{% endblock %}
