{% extends 'base.html' %}
{% load static %}
{% block content %}
  <div class="registration-container">
    <div class="row justify-content-center">
      <div class="col-lg-9 col-md-10">
        <div class="registration-card bg-white p-5 rounded-4 shadow-lg">
          <div class="mb-5 text-center">
            <div class="mb-3">
              <img src="{% static 'img/logo1.png' %}" alt="Scout Logo" style="height: 60px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
            </div>
            <h2 class="fw-bold mb-2" style="color: #1e3a8a; font-size: 2.5rem;">Create Account</h2>
            <p class="text-muted" style="font-size: 1.1rem;">Join ScoutConnect - Begin your scouting journey</p>
          </div>
      
          <!-- Registration Type Toggle Switch -->
          <div class="registration-type-card mb-4">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="mb-1 fw-bold">
                    <i class="fas fa-user me-2 text-primary" id="registrationTypeIcon"></i>
                    <span id="registrationTypeLabel">Single Registration</span>
                  </h5>
                  <small class="text-muted" style="font-size: 0.95rem;" id="registrationTypeDesc">Register one student</small>
                </div>
                <div class="form-check form-switch form-switch-lg">
                  <input class="form-check-input custom-switch" type="checkbox" role="switch" id="registrationTypeSwitch">
                </div>
              </div>
            </div>
          </div>
      
      <form method="post" id="registrationForm">
        {% csrf_token %}
        <input type="hidden" name="registration_type" id="registrationType" value="single">
        
        <!-- Single Registration Form (default) -->
        <div id="singleRegistrationForm">
          <!-- Display Fixed Registration Fee -->
          <div class="fee-card mb-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="mb-1 fw-bold"><i class="fas fa-tag me-2"></i>Registration Fee</h6>
                <small class="text-muted">Set by administrator</small>
              </div>
              <div class="text-end">
                <h3 class="mb-0 fw-bold" style="color: #1e3a8a;">₱500.00</h3>
              </div>
            </div>
          </div>
          
          {% for field in form %}
            <div class="mb-3">
              <label for="{{ field.id_for_label }}" class="form-label fw-bold">{{ field.label }}</label>
              {{ field }}
              {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
              {% endif %}
              {% for error in field.errors %}
                <div class="text-danger">{{ error }}</div>
              {% endfor %}
            </div>
          {% endfor %}
          
          <!-- Payment Information -->
          <div class="payment-info-card mb-4">
            <h6 class="fw-bold mb-3"><i class="fas fa-mobile-alt me-2"></i>Instant Payment - No Receipt Upload Needed!</h6>
            <p class="mb-3">After registration, you'll be redirected to pay securely via:</p>
            <div class="payment-methods mb-3">
              <div class="payment-badge"><i class="fab fa-google-wallet"></i> GCash</div>
              <div class="payment-badge"><i class="fas fa-wallet"></i> PayMaya</div>
              <div class="payment-badge"><i class="fas fa-mobile-alt"></i> GrabPay</div>
            </div>
            <ul class="payment-features mb-3">
              <li><i class="fas fa-check-circle text-success me-2"></i><strong>Instant verification</strong> - No waiting for admin approval</li>
              <li><i class="fas fa-shield-alt text-success me-2"></i><strong>Secure payment</strong> - Protected by PayMongo</li>
              <li><i class="fas fa-qrcode text-success me-2"></i><strong>Easy process</strong> - Just scan QR code in your e-wallet app</li>
            </ul>
            <p class="mb-0 text-muted small"><i class="fas fa-info-circle me-1"></i>Your account will be activated automatically after payment!</p>
          </div>
          
          <button type="submit" class="btn btn-register w-100 py-3 fw-bold">
            <i class="fas fa-user-plus me-2"></i>Register & Proceed to Payment
          </button>
        </div>
        
        <!-- Teacher Registration Form (hidden by default) -->
        <div id="teacherRegistrationForm" style="display: none;">
          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="fas fa-chalkboard-teacher"></i> Teacher Registration</h5>
            </div>
            <div class="card-body">
              <form method="post" action="{% url 'accounts:register_teacher' %}" id="teacherInlineForm">
                {% csrf_token %}
                {% if teacher_form %}
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="{{ teacher_form.first_name.id_for_label }}" class="form-label fw-bold">
                        <i class="fas fa-user me-1"></i>{{ teacher_form.first_name.label }}
                      </label>
                      {{ teacher_form.first_name }}
                      {% for error in teacher_form.first_name.errors %}
                        <div class="text-danger small mt-1">{{ error }}</div>
                      {% endfor %}
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="{{ teacher_form.last_name.id_for_label }}" class="form-label fw-bold">
                        <i class="fas fa-user me-1"></i>{{ teacher_form.last_name.label }}
                      </label>
                      {{ teacher_form.last_name }}
                      {% for error in teacher_form.last_name.errors %}
                        <div class="text-danger small mt-1">{{ error }}</div>
                      {% endfor %}
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="{{ teacher_form.email.id_for_label }}" class="form-label fw-bold">
                      <i class="fas fa-envelope me-1"></i>{{ teacher_form.email.label }}
                    </label>
                    {{ teacher_form.email }}
                    {% if teacher_form.email.help_text %}
                      <div class="form-text">
                        <i class="fas fa-info-circle me-1"></i>{{ teacher_form.email.help_text }}
                      </div>
                    {% endif %}
                    {% for error in teacher_form.email.errors %}
                      <div class="text-danger small mt-1">{{ error }}</div>
                    {% endfor %}
                  </div>

                  <div class="mb-3">
                    <label for="{{ teacher_form.phone_number.id_for_label }}" class="form-label fw-bold">
                      <i class="fas fa-phone me-1"></i>{{ teacher_form.phone_number.label }} (Optional)
                    </label>
                    {{ teacher_form.phone_number }}
                    {% for error in teacher_form.phone_number.errors %}
                      <div class="text-danger small mt-1">{{ error }}</div>
                    {% endfor %}
                  </div>

                  <div class="mb-3">
                    <label for="{{ teacher_form.password1.id_for_label }}" class="form-label fw-bold">
                      <i class="fas fa-lock me-1"></i>{{ teacher_form.password1.label }}
                    </label>
                    {{ teacher_form.password1 }}
                    {% if teacher_form.password1.help_text %}
                      <div class="form-text">{{ teacher_form.password1.help_text }}</div>
                    {% endif %}
                    {% for error in teacher_form.password1.errors %}
                      <div class="text-danger small mt-1">{{ error }}</div>
                    {% endfor %}
                  </div>

                  <div class="mb-4">
                    <label for="{{ teacher_form.password2.id_for_label }}" class="form-label fw-bold">
                      <i class="fas fa-lock me-1"></i>{{ teacher_form.password2.label }}
                    </label>
                    {{ teacher_form.password2 }}
                    {% for error in teacher_form.password2.errors %}
                      <div class="text-danger small mt-1">{{ error }}</div>
                    {% endfor %}
                  </div>
                {% endif %}

                <div class="alert alert-info">
                  <h6 class="fw-bold mb-2"><i class="fas fa-credit-card me-2"></i>Registration Fee: ₱500.00</h6>
                  <p class="mb-0 small">After registration you'll be redirected to complete payment. Your account will be active immediately.</p>
                </div>

                <button type="submit" class="btn btn-success w-100 py-3 fw-bold">
                  <i class="fas fa-user-graduate me-2"></i>Register as Teacher & Proceed to Payment
                </button>
              </form>
            </div>
          </div>
        </div>
      </form>
      
          <div class="text-center mt-4">
            <p class="text-muted mb-2">Already have an account?</p>
            <a href="{% url 'accounts:login' %}" class="btn btn-outline-primary rounded-pill px-4 py-2">
              <i class="fas fa-sign-in-alt me-2"></i>Sign In
            </a>
          </div>
          
          <div class="text-center mt-4">
            <a href="/" class="text-muted text-decoration-none">
              <i class="fas fa-arrow-left me-2"></i>Back to Home
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .registration-container {
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      padding: 3rem 0;
    }
    
    .registration-card {
      border: none;
    }
    
    .rounded-4 {
      border-radius: 1.5rem !important;
    }
    
    .registration-type-card {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 2px solid #bfdbfe;
      transition: all 0.3s ease;
    }
    
    .registration-type-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
    }
    
    .fee-card {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 2px solid #fbbf24;
    }
    
    .payment-info-card {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 2px solid #3b82f6;
    }
    
    .payment-methods {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .payment-badge {
      background: white;
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      font-weight: 600;
      color: #1e3a8a;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .payment-badge:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .payment-features {
      list-style: none;
      padding-left: 0;
    }
    
    .payment-features li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .payment-features li:last-child {
      border-bottom: none;
    }
    
    .form-control, .form-select {
      border-radius: 0.75rem;
      padding: 0.9rem 1.25rem;
      border: 2px solid #e5e7eb;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
      background: #f0f9ff;
    }
    
    .form-label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
    }
    
    .form-text {
      font-size: 0.875em;
      color: #6b7280;
    }
    
    form p {
      margin-bottom: 0.5rem;
    }
    
    /* Custom toggle switch styling */
    .custom-switch {
      width: 60px;
      height: 30px;
      cursor: pointer;
    }
    
    .custom-switch:checked {
      background-color: #10b981;
      border-color: #10b981;
    }
    
    .custom-switch:focus {
      box-shadow: 0 0 0 0.25rem rgba(16, 185, 129, 0.25);
    }
    
    /* Buttons */
    .btn-register {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      border: none;
      font-size: 1.1rem;
      border-radius: 3rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
    }

    .btn-register:hover {
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
      color: white;
    }
    
    .btn-outline-primary {
      border: 2px solid #3b82f6;
      color: #1e3a8a;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
      background: #3b82f6;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    /* Smooth transitions */
    #singleRegistrationForm,
    #batchRegistrationForm {
      transition: opacity 0.3s ease-in-out;
    }
    
    .alert {
      border-radius: 0.75rem;
    }
    
    .card {
      border-radius: 1rem;
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .card-header {
      border-radius: 1rem 1rem 0 0 !important;
      font-weight: 600;
    }
    
    @media (max-width: 768px) {
      .registration-container {
        padding: 2rem 1rem;
      }
      
      .registration-card {
        padding: 2rem !important;
      }
    }
  </style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const input = document.querySelector("#id_phone_number");
        if (input) {
            window.intlTelInput(input, {
                initialCountry: "auto",
                geoIpLookup: function(callback) {
                    fetch("https://ipapi.co/json")
                        .then(res => res.json())
                        .then(data => callback(data.country_code))
                        .catch(() => callback("us"));
                },
                utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@25.3.1/build/js/utils.js"
            });
        }
        
    // Prepare registration form elements and teacher inline form
    const registrationForm = document.getElementById('registrationForm');
    const teacherInlineFormWrapper = document.getElementById('teacherRegistrationForm');
    const teacherInlineForm = document.getElementById('teacherInlineForm');
    const singleFormEl = document.getElementById('singleRegistrationForm');
        
        // Registration Type Toggle Switch
        const toggleSwitch = document.getElementById('registrationTypeSwitch');
        const registrationType = document.getElementById('registrationType');
        const typeLabel = document.getElementById('registrationTypeLabel');
        const typeIcon = document.getElementById('registrationTypeIcon');
        const typeDesc = document.getElementById('registrationTypeDesc');
        const singleForm = document.getElementById('singleRegistrationForm');
        const teacherFormWrapper = document.getElementById('teacherRegistrationForm');

        if (toggleSwitch) {
            toggleSwitch.addEventListener('change', function() {
                if (this.checked) {
                    // Switch to Teacher Registration
                    registrationType.value = 'teacher';
                    typeLabel.textContent = 'Teacher Registration';
                    typeIcon.className = 'fas fa-chalkboard-teacher me-2';
                    typeDesc.textContent = 'Register as a teacher';
                    if (singleForm) singleForm.style.display = 'none';
                    if (teacherFormWrapper) teacherFormWrapper.style.display = 'block';
                    // Enable teacher form inputs
                    if (teacherFormWrapper) Array.from(teacherFormWrapper.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = false; });
                    // Disable single form inputs
                    if (singleForm) Array.from(singleForm.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = true; });
                } else {
                    // Switch to Single Registration
                    registrationType.value = 'single';
                    typeLabel.textContent = 'Single Registration';
                    typeIcon.className = 'fas fa-user me-2';
                    typeDesc.textContent = 'Register one student';
                    if (singleForm) singleForm.style.display = 'block';
                    if (teacherFormWrapper) teacherFormWrapper.style.display = 'none';
                    // Enable single form inputs
                    if (singleForm) Array.from(singleForm.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = false; });
                    // Disable teacher form inputs
                    if (teacherFormWrapper) Array.from(teacherFormWrapper.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = true; });
                }
            });

            // On page load, ensure only visible form's fields are enabled
            // If the server requested teacher mode (e.g., validation errors), reflect that state
            {% if registration_type == 'teacher' %}
                if (toggleSwitch) toggleSwitch.checked = true;
                if (registrationType) registrationType.value = 'teacher';
                if (typeLabel) typeLabel.textContent = 'Teacher Registration';
                if (typeIcon) typeIcon.className = 'fas fa-chalkboard-teacher me-2';
                if (typeDesc) typeDesc.textContent = 'Register as a teacher';
                if (singleForm) {
                    singleForm.style.display = 'none';
                    Array.from(singleForm.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = true; });
                }
                if (teacherFormWrapper) {
                    teacherFormWrapper.style.display = 'block';
                    Array.from(teacherFormWrapper.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = false; });
                }
            {% else %}
                // Default: single registration visible
                if (singleForm) Array.from(singleForm.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = false; });
                if (teacherFormWrapper) Array.from(teacherFormWrapper.querySelectorAll('input, select, textarea')).forEach(function(el) { el.disabled = true; });
            {% endif %}
        }
    });
</script>
{% endblock %} 