{% extends 'base.html' %}
{% load static %}
{% block content %}
  <div class="container-fluid py-4">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-10">
        <div class="card shadow-sm text-center">
          <div class="card-body">
            <h5 class="card-title">Payment Summary</h5>
            <div class="row g-2">
              <div class="col-2">
                <div class="fw-bold text-success">₱{{ total_paid }}</div>
                <div class="small">Total Paid</div>
              </div>
              <div class="col-2">
                <div class="fw-bold text-primary">₱{{ total_dues }}</div>
                <div class="small">Total Dues</div>
              </div>
              <div class="col-2">
                <div class="fw-bold {% if balance >= 0 %}text-success{% else %}text-danger{% endif %}">₱{{ balance }}</div>
                <div class="small">Balance</div>
              </div>
              <div class="col-2">
                <div class="fw-bold">
                  <span class="badge {% if registration_status == 'active' %}bg-success{% elif registration_status == 'payment_submitted' %}bg-warning{% else %}bg-secondary{% endif %}">
                    {{ member.get_registration_status_display }}
                  </span>
                </div>
                <div class="small">Status</div>
              </div>
              <div class="col-2">
                <div class="fw-bold text-info">₱{{ registration_payment }}</div>
                <div class="small">Registration</div>
              </div>
              <div class="col-2">
                <div class="fw-bold text-warning">₱{{ event_payments }}</div>
                <div class="small">Events</div>
              </div>
            </div>
            
            <!-- Payment Breakdown -->
            <div class="mt-3">
              <h6>Payment Breakdown:</h6>
              <div class="row g-2">
                <div class="col-md-4">
                  <small class="text-muted">Registration Payments:</small><br>
                  <span class="fw-bold">₱{{ registration_payments }}</span>
                </div>
                <div class="col-md-4">
                  <small class="text-muted">Event Payments:</small><br>
                  <span class="fw-bold">₱{{ event_payments }}</span>
                </div>
                <div class="col-md-4">
                  <small class="text-muted">Other Payments:</small><br>
                  <span class="fw-bold">₱{{ general_payments }}</span>
                </div>
              </div>
              
              <!-- Dues Breakdown -->
              <div class="mt-3">
                <h6>Outstanding Dues:</h6>
                <div class="row g-2">
                  <div class="col-md-6">
                    <small class="text-muted">Registration Dues:</small><br>
                    <span class="fw-bold text-warning">₱{{ registration_dues }}</span>
                  </div>
                  <div class="col-md-6">
                    <small class="text-muted">Event Dues:</small><br>
                    <span class="fw-bold text-warning">₱{{ event_dues }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-4">Member Profile</h4>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Name:</strong></div>
            <div class="col-md-8">{{ member.get_full_name }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Email:</strong></div>
            <div class="col-md-8">{{ member.email }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Registration Status:</strong></div>
            <div class="col-md-8">
              <span class="badge {% if member.registration_status == 'active' %}bg-success{% elif member.registration_status == 'payment_submitted' %}bg-warning{% else %}bg-secondary{% endif %}">
                {{ member.get_registration_status_display }}
              </span>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Rank:</strong></div>
            <div class="col-md-8">{{ member.get_rank_display }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Date of Birth:</strong></div>
            <div class="col-md-8">{{ member.date_of_birth|date:"F d, Y"|default:"Not provided" }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Phone Number:</strong></div>
            <div class="col-md-8">{{ member.phone_number|default:"Not provided" }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Address:</strong></div>
            <div class="col-md-8">{{ member.address|default:"Not provided"|linebreaks }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Emergency Contact:</strong></div>
            <div class="col-md-8">{{ member.emergency_contact|default:"Not provided" }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Emergency Phone:</strong></div>
            <div class="col-md-8">{{ member.emergency_phone|default:"Not provided" }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Medical Conditions:</strong></div>
            <div class="col-md-8">{{ member.medical_conditions|default:"None"|linebreaks }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Allergies:</strong></div>
            <div class="col-md-8">{{ member.allergies|default:"None"|linebreaks }}</div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-4"><strong>Join Date:</strong></div>
            <div class="col-md-8">{{ member.join_date|date:"F d, Y" }}</div>
          </div>
          
          {% if user.is_admin or user.pk == member.pk %}
            <div class="mt-4">
              <a href="{% url 'accounts:member_edit' member.pk %}" class="btn btn-outline-primary">Edit Profile</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Verified Registration Payments Section -->
  {% if verified_registration_payments %}
    <div class="row justify-content-center mt-4">
      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header">
            <h5 class="mb-0">Verified Registration Payments</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Verified By</th>
                    <th>Verification Date</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  {% for payment in verified_registration_payments %}
                    <tr>
                      <td>{{ payment.created_at|date:"M d, Y" }}</td>
                      <td class="text-success">₱{{ payment.amount }}</td>
                      <td>{{ payment.verified_by.get_full_name }}</td>
                      <td>{{ payment.verification_date|date:"M d, Y" }}</td>
                      <td>{{ payment.notes|default:"-" }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  
  <!-- Verified Event Payments Section -->
  {% if verified_event_payments %}
    <div class="row justify-content-center mt-4">
      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header">
            <h5 class="mb-0">Verified Event Payments</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Verified By</th>
                    <th>Verification Date</th>
                  </tr>
                </thead>
                <tbody>
                  {% for reg in verified_event_payments %}
                    <tr>
                      <td>{{ reg.event.title }}</td>
                      <td>{{ reg.event.date|date:"M d, Y" }}</td>
                      <td class="text-success">₱{{ reg.event.payment_amount }}</td>
                      <td>{{ reg.verified_by.get_full_name }}</td>
                      <td>{{ reg.verification_date|date:"M d, Y" }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %} 