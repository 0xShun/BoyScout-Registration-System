{% extends 'base_sidebar.html' %}
{% load static %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-trash me-2"></i>Delete Student Account
                    </h4>
                </div>
                <div class="card-body">
                    <p class="lead mb-4">
                        Are you sure you want to delete the student account for 
                        <strong>{{ student.get_full_name }}</strong> ({{ student.email }})?
                    </p>

                    <!-- Student Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-person-circle me-2"></i>Student Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-2"><strong>Full Name:</strong> {{ student.get_full_name }}</p>
                                    <p class="mb-2"><strong>Username:</strong> @{{ student.username }}</p>
                                    <p class="mb-2"><strong>Email:</strong> {{ student.email }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-2"><strong>Status:</strong> 
                                        {% if student.registration_status == 'active' or student.registration_status == 'payment_verified' %}
                                            <span class="badge bg-success">Active</span>
                                        {% elif student.registration_status == 'pending_payment' or student.registration_status == 'pending' %}
                                            <span class="badge bg-warning">Pending Payment</span>
                                        {% elif student.registration_status == 'inactive' %}
                                            <span class="badge bg-secondary">Inactive</span>
                                        {% elif student.registration_status == 'graduated' %}
                                            <span class="badge bg-info">Graduated</span>
                                        {% elif student.registration_status == 'suspended' %}
                                            <span class="badge bg-danger">Suspended</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ student.get_registration_status_display }}</span>
                                        {% endif %}
                                    </p>
                                    <p class="mb-2"><strong>Joined:</strong> {{ student.date_joined|date:"M d, Y" }}</p>
                                    <p class="mb-2"><strong>Rank:</strong> {{ student.get_rank_display }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {% if dependencies %}
                    <div class="card border-danger mb-4">
                        <div class="card-header bg-danger text-white">
                            <h6 class="mb-0">
                                <i class="bi bi-database me-2"></i>Impact: Associated Records Will Be Deleted
                            </h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2">
                                Deleting this student will also <strong>permanently delete</strong> the following associated records:
                            </p>
                            <ul class="mb-0">
                                {% for dep_type, count in dependencies.items %}
                                    <li><strong>{{ dep_type }}:</strong> {{ count }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Confirmation Checkbox -->
                    <div class="form-check mb-4 p-3 bg-light rounded">
                        <input class="form-check-input" type="checkbox" id="confirmDelete">
                        <label class="form-check-label fw-bold" for="confirmDelete">
                            I understand that this action is permanent and cannot be undone.
                        </label>
                    </div>
                    
                    <form method="post" id="deleteForm" action="{% url 'accounts:teacher_delete_student' student.id %}">
                        {% csrf_token %}
                        <div class="d-flex justify-content-between gap-2">
                            <a href="{% url 'accounts:teacher_student_detail' student.id %}" class="btn btn-secondary">
                                <i class="bi bi-x-circle me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-danger" id="deleteButton" disabled>
                                <i class="bi bi-trash me-2"></i>Yes, Delete Student
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Enable delete button only when checkbox is checked
    document.getElementById('confirmDelete').addEventListener('change', function() {
        document.getElementById('deleteButton').disabled = !this.checked;
    });
</script>
{% endblock %}
